---
title: "An√°lisis exploratorio de datos"
date: "Marzo 2019"
output: 
  html_notebook
---


```{r setup}
library(tidyverse)
library(ggthemes)
library(ggfortify)
library(treemapify)
library(RColorBrewer)
library(shiny)
library(shinythemes)
library(shinycssloaders)
library(glue)
library(readxl)
library(DT)
```


### Treemap mundo. Cadenas y subcadenas

```{r}
dataset <- read.delim('data/Export_agg_country_prod_yr.txt',sep = ',', encoding = 'UTF-8')
#renombro las variables

dataset_summ <-dataset %>% 
  group_by(Cadena, Subcadena) %>% 
  summarise(value = sum(value, na.rm = T)) %>% 
  ungroup() %>% 
  mutate(Subcadena = as.character(Subcadena))

dataset_summ$Subcadena[str_detect(dataset_summ$Subcadena, 'CTEOS')] <- 'LACTEOS'

dataset_summ %>% 
  ggplot(., aes(area = value, fill = Cadena, label = Subcadena, subgroup = Cadena)) + 
  geom_treemap(alpha = 1)+
  geom_treemap_subgroup_text(place = "bottomright", grow = T, alpha = 0.5, colour =
                               "black", fontface = "italic", min.size = 0) +
  geom_treemap_text(colour = "white", place = "topleft", reflow = T)+
  # labs(title= glue("Treemap {flow_filter}, {reportante}, year {nano}"))+
  # scale_fill_manual(values = colores)+
  theme_tufte()+
  theme(legend.position = "None",
        title = element_text(size = 18),
        strip.text = element_text(size=18))


ggsave('graficos/treemap_cadsubcad.png', width = 7,height = 7)
```



### Treemap mundo. Cadenas y usos

```{r}

dataset_summ_usos <-dataset %>% 
  group_by(Cadena, Flores) %>% 
  summarise(value = sum(value, na.rm = T)) %>% 
  ungroup() 

dataset_summ_usos %>% 
  ggplot(., aes(area = value, fill = Cadena, label = Flores, subgroup = Cadena)) + 
  geom_treemap(alpha = 1)+
  geom_treemap_subgroup_text(place = "bottomright", grow = T, alpha = 0.5, colour =
                               "black", fontface = "italic", min.size = 0) +
  geom_treemap_text(colour = "white", place = "topleft", reflow = T)+
  # labs(title= glue("Treemap {flow_filter}, {reportante}, year {nano}"))+
  # scale_fill_manual(values = colores)+
  theme_tufte()+
  theme(legend.position = "None",
        title = element_text(size = 18),
        strip.text = element_text(size=18))


ggsave('graficos/treemap_usos.png', width = 7,height = 7)
```


#### Treemap mundo. Paises receptores

```{r}
df <- readRDS('data/aggregated_trade.RDS')

countrycode_data <- countrycode::codelist %>% select(cldr.short.es_ar, cldr.short.en,iso3c,region,continent)
df <- left_join(df,countrycode_data 
                      %>% select(rt3ISO=iso3c, continent, cldr.short.es_ar)) %>% 
  na.omit(.)

df_summ_paieses <- df %>% 
  group_by(continent,cldr.short.es_ar,rgDesc) %>% 
  summarise(value = sum(TradeValue)) %>% 
  filter(rgDesc %in% c('Export', 'Import')) 
  
df_summ_paieses %>% 
ggplot(., aes(area = value, fill = continent, label = cldr.short.es_ar, subgroup = continent)) + 
  geom_treemap(alpha = 1, layout = "fixed")+
  geom_treemap_subgroup_text(place = "bottomright", grow = T, alpha = 0.5, colour =
                               "black", fontface = "italic", min.size = 0, layout = "fixed") +
  geom_treemap_text(colour = "white", place = "topleft", reflow = T, layout = "fixed")+
  theme_tufte()+
  theme(legend.position = "None",
        title = element_text(size = 18),
        strip.text = element_text(size=18))+
        facet_grid(.~rgDesc)


ggsave('graficos/treemap_paises.png', width = 7,height = 7)
```

